var tame = require('tamejs').runtime;
var __tame_defer_cb = null;
var __tame_fn_0 = function (__tame_k) {
    tame.setActiveCb (__tame_defer_cb);
    var assert = require ( "assert" ) ;
    
    var slots = { } ;
    function makeTest (exports) {
        exports [ "rendezvous & windowing example" ] = {
        
        run :
        function  (ev) {
            var __tame_defer_cb = tame.findDeferCb ([ev]);
            tame.setActiveCb (__tame_defer_cb);
            var __tame_this = this;
            var __tame_fn_5 = function (__tame_k) {
                tame.setActiveCb (__tame_defer_cb);
                function call (i, ev) {
                    var __tame_defer_cb = tame.findDeferCb ([i, ev]);
                    tame.setActiveCb (__tame_defer_cb);
                    var __tame_this = this;
                    var __tame_fn_10 = function (__tame_k) {
                        tame.setActiveCb (__tame_defer_cb);
                        slots [ i ] = 1 ;
                        var __tame_fn_6 = function (__tame_k) {
                            tame.setActiveCb (__tame_defer_cb);
                            var __tame_fn_7 = function (__tame_k) {
                                tame.setActiveCb (__tame_defer_cb);
                                var __tame_defers = new tame.Deferrals (__tame_k);
                                var __tame_fn_8 = function (__tame_k) {
                                    tame.setActiveCb (__tame_defer_cb);
                                    setTimeout (
                                    __tame_defers.defer ( { 
                                        func_name : "call",
                                        parent_cb : __tame_defer_cb,
                                        line : 15,
                                        file : "/home/max/node/tamejs/test/cases/lib/29.tamejs"
                                    } )
                                    , 10*Math . random ( ) ) ;
                                    tame.callChain([__tame_k]);
                                    tame.setActiveCb (null);
                                };
                                __tame_fn_8(tame.end);
                                __tame_defers._fulfill();
                                tame.setActiveCb (null);
                            };
                            var __tame_fn_9 = function (__tame_k) {
                                tame.setActiveCb (__tame_defer_cb);
                                slots [ i ] |= 2 ;
                                ev ( ) ;
                                tame.callChain([__tame_k]);
                                tame.setActiveCb (null);
                            };
                            tame.callChain([__tame_fn_7, __tame_fn_9, __tame_k]);
                            tame.setActiveCb (null);
                        };
                        tame.callChain([__tame_fn_6, __tame_k]);
                        tame.setActiveCb (null);
                    };
                    tame.callChain([__tame_fn_10, __tame_k]);
                    tame.setActiveCb (null);
                }
                ;
                function window (n, window, ev) {
                    var __tame_defer_cb = tame.findDeferCb ([n, window, ev]);
                    tame.setActiveCb (__tame_defer_cb);
                    var __tame_this = this;
                    var __tame_fn_21 = function (__tame_k) {
                        tame.setActiveCb (__tame_defer_cb);
                        var rv = new tame . Rendezvous ( ) ;
                        var nsent = 0 ;
                        var nrecv = 0 ;
                        var __tame_fn_11 = function (__tame_k) {
                            tame.setActiveCb (__tame_defer_cb);
                            var __tame_fn_12 = function (__tame_k) {
                                tame.setActiveCb (__tame_defer_cb);
                                var __tame_k_implicit = {};
                                var __tame_fn_13 = function (__tame_k) {
                                    tame.setActiveCb (__tame_defer_cb);
                                    if (nrecv < n) {
                                        var __tame_fn_14 = function (__tame_k) {
                                            tame.setActiveCb (__tame_defer_cb);
                                            var __tame_fn_15 = function (__tame_k) {
                                                tame.setActiveCb (__tame_defer_cb);
                                                call ( nsent , rv . id ( nsent ) .
                                                __tame_defers.defer ( { 
                                                    func_name : "window",
                                                    parent_cb : __tame_defer_cb,
                                                    line : 29,
                                                    file : "/home/max/node/tamejs/test/cases/lib/29.tamejs"
                                                } )
                                                ) ;
                                                nsent ++ ;
                                                tame.callChain([__tame_k]);
                                                tame.setActiveCb (null);
                                            };
                                            var __tame_fn_16 = function (__tame_k) {
                                                tame.setActiveCb (__tame_defer_cb);
                                                var res;
                                                var __tame_fn_17 = function (__tame_k) {
                                                    tame.setActiveCb (__tame_defer_cb);
                                                    var __tame_defers = new tame.Deferrals (__tame_k);
                                                    var __tame_fn_18 = function (__tame_k) {
                                                        tame.setActiveCb (__tame_defer_cb);
                                                        rv . wait (
                                                        __tame_defers.defer ( { 
                                                            assign_fn : 
                                                                function () {
                                                                    res = arguments[0];
                                                                }
                                                                ,
                                                            func_name : "window",
                                                            parent_cb : __tame_defer_cb,
                                                            line : 32,
                                                            file : "/home/max/node/tamejs/test/cases/lib/29.tamejs"
                                                        } )
                                                        ) ;
                                                        tame.callChain([__tame_k]);
                                                        tame.setActiveCb (null);
                                                    };
                                                    __tame_fn_18(tame.end);
                                                    __tame_defers._fulfill();
                                                    tame.setActiveCb (null);
                                                };
                                                var __tame_fn_19 = function (__tame_k) {
                                                    tame.setActiveCb (__tame_defer_cb);
                                                    slots [ res ] |= 4 ;
                                                    nrecv ++ ;
                                                    tame.callChain([__tame_k]);
                                                    tame.setActiveCb (null);
                                                };
                                                tame.callChain([__tame_fn_17, __tame_fn_19, __tame_k]);
                                                tame.setActiveCb (null);
                                            };
                                            if (nsent - nrecv < window && nsent < n) {
                                                tame.callChain([__tame_fn_15, __tame_k]);
                                            } else {
                                                tame.callChain([__tame_fn_16, __tame_k]);
                                            }
                                            tame.setActiveCb (null);
                                        };
                                        tame.callChain([__tame_fn_14, __tame_fn_13, __tame_k]);
                                    } else {
                                        tame.callChain([__tame_k]);
                                    }
                                    tame.setActiveCb (null);
                                };
                                __tame_k_implicit.k_break = __tame_k;
                                __tame_k_implicit.k_continue = function() { __tame_fn_13(__tame_k); };
                                tame.callChain([__tame_fn_13, __tame_k]);
                                tame.setActiveCb (null);
                            };
                            var __tame_fn_20 = function (__tame_k) {
                                tame.setActiveCb (__tame_defer_cb);
                                ev ( ) ;
                                tame.callChain([__tame_k]);
                                tame.setActiveCb (null);
                            };
                            tame.callChain([__tame_fn_12, __tame_fn_20, __tame_k]);
                            tame.setActiveCb (null);
                        };
                        tame.callChain([__tame_fn_11, __tame_k]);
                        tame.setActiveCb (null);
                    };
                    tame.callChain([__tame_fn_21, __tame_k]);
                    tame.setActiveCb (null);
                }
                ;
                
                var n = 100 ;
                var __tame_fn_1 = function (__tame_k) {
                    tame.setActiveCb (__tame_defer_cb);
                    var __tame_fn_2 = function (__tame_k) {
                        tame.setActiveCb (__tame_defer_cb);
                        var __tame_defers = new tame.Deferrals (__tame_k);
                        var __tame_fn_3 = function (__tame_k) {
                            tame.setActiveCb (__tame_defer_cb);
                            window ( n , 10 ,
                            __tame_defers.defer ( { 
                                parent_cb : __tame_defer_cb,
                                line : 41,
                                file : "/home/max/node/tamejs/test/cases/lib/29.tamejs"
                            } )
                            ) ;
                            tame.callChain([__tame_k]);
                            tame.setActiveCb (null);
                        };
                        __tame_fn_3(tame.end);
                        __tame_defers._fulfill();
                        tame.setActiveCb (null);
                    };
                    var __tame_fn_4 = function (__tame_k) {
                        tame.setActiveCb (__tame_defer_cb);
                        ev ( ) ;
                        tame.callChain([__tame_k]);
                        tame.setActiveCb (null);
                    };
                    tame.callChain([__tame_fn_2, __tame_fn_4, __tame_k]);
                    tame.setActiveCb (null);
                };
                tame.callChain([__tame_fn_1, __tame_k]);
                tame.setActiveCb (null);
            };
            tame.callChain([__tame_fn_5, __tame_k]);
            tame.setActiveCb (null);
        }
        ,
        
        check :
        function  () {
             for (var i in slots) {
                assert . equal ( slots [ i ] , 7 , "all 3 events make bitwise 7" ) ;
            }
        }
        } ;
    }
    ;
    
    exports . makeTest = makeTest ;
    tame.callChain([__tame_k]);
    tame.setActiveCb (null);
};
__tame_fn_0 (tame.end);